var Wiring=(function(){var d=Object,f=null;function j(n){return d.prototype.toString.call(n)==="[object Array]"}function m(n){this.object=n}function l(s){var q=1,o=arguments.length,n,u,r,t;for(;q<o;q++){n=arguments[q];if(n){for(u in n){if(n.hasOwnProperty(u)){t=n[u];if(t instanceof m){t=t.object;if(u in s&&(r=s[u])){t=(j(r)&&j(t))?r.concat(t):l({},r,t)}}s[u]=t}}}}return s}function k(q,r,p){var o=function(){},n="prototype";o[n]=r[n];q[n]=l(new o(),p,{constructor:q})}function h(r){var q=this,p=r.split("."),o=0,n=p.length;for(;o<n;o++){q=q[p[o]]}return q}function g(){}k(g,d,{wiring:f});function c(o,n){this.wiring=o;this.cfg=n}c.defaults={type:d,singleton:true,ctorArgs:[],properties:{},initMethod:f,parent:f};c.PLACEHOLDER_RE=/^\{(\w+):(.+)\}$/;k(c,d,{expand:function(u){var r,o,s,q,t,n;if(j(u)){n=[];for(r=0;(o=u[r]);r++){n.push(this.expand(o))}}else{if(typeof u==="object"&&u!==f){n={};for(s in u){if(u.hasOwnProperty(s)){n[s]=this.expand(u[s])}}}else{if(typeof u==="string"&&(q=u.match(c.PLACEHOLDER_RE))){t=this.wiring._resolvers[q[1]];n=(t?t.resolve(q[2]):u)}else{n=u}}}return n},getParent:function(){var n=this.cfg.parent;return(n&&this.wiring._defs[n])||f},getCascadedCfg:function(){var o="_cascCfg",n,p,q,r=this[o];if(!r){n=this.cfg;p=this.getParent();if(p){p=p.getCascadedCfg();q=l({},p,n);q.ctorArgs=l([],p.ctorArgs,n.ctorArgs);q.properties=l({},p.properties,n.properties);n=q}r=this[o]=l({},c.defaults,n);if(typeof r.type==="string"){r.type=h(r.type)}}return r},getInstance:function(){var n,r,y,t,x,w=this.getCascadedCfg(),u=w.properties,q=w.type,s=w.ctorArgs,o="function";t=this._instance;if(t&&w.singleton){return t}if(s.length>0){x=function(){};x.prototype=q.prototype;t=new x();q.apply(t,this.expand(s))}else{t=new q()}if(w.singleton){this._instance=t}if(t instanceof g){t.wiring=this.wiring}for(n in u){if(u.hasOwnProperty(n)){r=t["set"+n.charAt(0).toUpperCase()+n.substring(1)];y=this.expand(u[n]);if(r&&typeof r===o){r.call(t,y)}else{t[n]=y}}}if((r=w.initMethod)&&(r=t[r])&&typeof r===o){r.call(t)}return t}});function a(){}k(a,g,{refId:f,createInstance:function(p){if(p){var o=l({},p,{parent:this.refId}),n=new c(this.wiring,o);return n.getInstance()}return this.wiring.get(this.refId)}});function i(){}k(i,g,{prefix:"",resolve:function(n){return n}});function e(){}k(e,i,{prefix:"ref",resolve:function(n){return this.wiring.get(n)}});function b(){this._defs={};this._resolvers={};this.addValueResolver(new e())}k(b,d,{add:function(n){for(var o in n){if(n.hasOwnProperty(o)){this._defs[o]=new c(this,n[o])}}},get:function(n){var o=this._defs[n];return(o?o.getInstance():f)},addValueResolver:function(n){n.wiring=this;this._resolvers[n.prefix]=n},mergeUp:function(n){return new m(n)},WiringAware:g,Factory:a,ValueResolver:i});return new b()})();