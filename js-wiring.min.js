var Wiring=(function(){function h(m){for(var l=1,k=arguments.length,j,n;l<k;l++){j=arguments[l];if(j){for(n in j){if(j.hasOwnProperty(n)){m[n]=j[n]}}}}return m}function g(l,m,k){var j=function(){},i;j.prototype=m.prototype;l.prototype=h(new j(),k,{constructor:l})}function e(){}g(e,Object,{wiring:null});function d(j,i){this.wiring=j;this.def=i}d.defaults={type:Object,singleton:true,ctorArgs:[],properties:{},initMethod:null,parent:null};d.PLACEHOLDER_RE=/^\{(\w+):(.+)\}$/;d.prototype={expand:function(q){var m,k,n,l,o,j;if(Object.prototype.toString.call(q)==="[object Array]"){j=[];for(m=0;(k=q[m]);m++){j.push(this.expand(k))}}else{if(typeof q==="object"&&q!==null){j={};for(n in q){if(q.hasOwnProperty(n)){j[n]=this.expand(q[n])}}}else{if(typeof q==="string"&&(l=q.match(d.PLACEHOLDER_RE))){o=this.wiring._resolvers[l[1]];j=(o?o.resolve(l[2]):q)}else{j=q}}}return j},getParent:function(){var i=this.def.parent;return(i&&this.wiring._defs[i])||null},getCascadedDef:function(){var i="_cascadedDef",l,j,k,m=this[i];if(!m){l=this.def;j=this.getParent();if(j){j=j.getCascadedDef();k=h({},j,l);k.ctorArgs=h([],j.ctorArgs,l.ctorArgs);k.properties=h({},j.properties,l.properties);l=k}m=this[i]=h({},d.defaults,l)}return m},getInstance:function(){var j,l,u,o,n,q,s,t,k=this.getCascadedDef(),r=k.properties;o=this._instance;if(o&&k.singleton){return o}s=[];t=[];q=k.ctorArgs.length;if(q>0){for(n=0;n<q;n++){s.push(this.expand(k.ctorArgs[n]));t.push("a["+n+"]")}o=(new Function("T","a","return new T("+t.join(",")+")"))(k.type,s)}else{o=new k.type()}if(k.singleton){this._instance=o}if(o instanceof e){o.wiring=this.wiring}for(j in r){if(r.hasOwnProperty(j)){l=o["set"+j.charAt(0).toUpperCase()+j.substring(1)];u=this.expand(r[j]);if(l&&typeof l==="function"){l.call(o,u)}else{o[j]=u}}}if((l=k.initMethod)&&(l=o[l])&&typeof l==="function"){l.call(o)}return o}};function c(){}g(c,e,{refId:null,createInstance:function(k){if(k){var j=h({},k,{parent:this.refId}),i=new d(this.wiring,j);return i.getInstance()}return this.wiring.get(this.refId)}});function f(){}g(f,e,{prefix:"",resolve:function(i){return i}});function b(){}g(b,f,{prefix:"ref",resolve:function(i){return this.wiring.get(i)}});function a(){this._defs={};this._resolvers={};this.addValueResolver(new b())}g(a,Object,{add:function(i){for(var j in i){if(i.hasOwnProperty(j)){this._defs[j]=new d(this,i[j])}}},get:function(i){var j=this._defs[i];return(j?j.getInstance():null)},addValueResolver:function(i){i.wiring=this;this._resolvers[i.prefix]=i},WiringAware:e,Factory:c,ValueResolver:f});return new a()})();