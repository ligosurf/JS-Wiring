var Wiring=(function(){var d=Object,f=null;function j(n){for(var m=1,l=arguments.length,k,o;m<l;m++){k=arguments[m];if(k){for(o in k){if(k.hasOwnProperty(o)){n[o]=k[o]}}}}return n}function i(n,o,m){var l=function(){},k="prototype";l[k]=o[k];n[k]=j(new l(),m,{constructor:n})}function g(){}i(g,d,{wiring:f});function c(l,k){this.wiring=l;this.def=k}c.defaults={type:d,singleton:true,ctorArgs:[],properties:{},initMethod:f,parent:f};c.PLACEHOLDER_RE=/^\{(\w+):(.+)\}$/;i(c,d,{expand:function(r){var n,l,o,m,q,k;if(d.prototype.toString.call(r)==="[object Array]"){k=[];for(n=0;(l=r[n]);n++){k.push(this.expand(l))}}else{if(typeof r==="object"&&r!==f){k={};for(o in r){if(r.hasOwnProperty(o)){k[o]=this.expand(r[o])}}}else{if(typeof r==="string"&&(m=r.match(c.PLACEHOLDER_RE))){q=this.wiring._resolvers[m[1]];k=(q?q.resolve(m[2]):r)}else{k=r}}}return k},getParent:function(){var k=this.def.parent;return(k&&this.wiring._defs[k])||f},getCascadedDef:function(){var k="_cascDef",n,l,m,o=this[k];if(!o){n=this.def;l=this.getParent();if(l){l=l.getCascadedDef();m=j({},l,n);m.ctorArgs=j([],l.ctorArgs,n.ctorArgs);m.properties=j({},l.properties,n.properties);n=m}o=this[k]=j({},c.defaults,n)}return o},getInstance:function(){var k,o,w,q,u,l=this.getCascadedDef(),t=l.properties,r=l.type,s=l.ctorArgs,n="function";q=this._instance;if(q&&l.singleton){return q}if(s.length>0){u=function(){};u.prototype=r.prototype;q=new u();r.apply(q,this.expand(s))}else{q=new r()}if(l.singleton){this._instance=q}if(q instanceof g){q.wiring=this.wiring}for(k in t){if(t.hasOwnProperty(k)){o=q["set"+k.charAt(0).toUpperCase()+k.substring(1)];w=this.expand(t[k]);if(o&&typeof o===n){o.call(q,w)}else{q[k]=w}}}if((o=l.initMethod)&&(o=q[o])&&typeof o===n){o.call(q)}return q}});function a(){}i(a,g,{refId:f,createInstance:function(m){if(m){var l=j({},m,{parent:this.refId}),k=new c(this.wiring,l);return k.getInstance()}return this.wiring.get(this.refId)}});function h(){}i(h,g,{prefix:"",resolve:function(k){return k}});function e(){}i(e,h,{prefix:"ref",resolve:function(k){return this.wiring.get(k)}});function b(){this._defs={};this._resolvers={};this.addValueResolver(new e())}i(b,d,{add:function(k){for(var l in k){if(k.hasOwnProperty(l)){this._defs[l]=new c(this,k[l])}}},get:function(k){var l=this._defs[k];return(l?l.getInstance():f)},addValueResolver:function(k){k.wiring=this;this._resolvers[k.prefix]=k},WiringAware:g,Factory:a,ValueResolver:h});return new b()})();