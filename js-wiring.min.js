var Wiring=(function(){var d=Object,f=null;function i(m){return d.prototype.toString.call(m)==="[object Array]"}function l(m){this.object=m}function k(r){var o=1,n=arguments.length,m,t,q,s;for(;o<n;o++){m=arguments[o];if(m){for(t in m){if(m.hasOwnProperty(t)){s=m[t];if(s instanceof l){s=s.object;if(t in r&&(q=r[t])){s=(i(q)&&i(s))?q.concat(s):k({},q,s)}}r[t]=s}}}}return r}function j(p,q,o){var n=function(){},m="prototype";n[m]=q[m];p[m]=k(new n(),o,{constructor:p})}function g(){}j(g,d,{wiring:f});function c(n,m){this.wiring=n;this.cfg=m}c.defaults={type:d,singleton:true,ctorArgs:[],properties:{},initMethod:f,parent:f};c.PLACEHOLDER_RE=/^\{(\w+):(.+)\}$/;j(c,d,{expand:function(t){var q,n,r,o,s,m;if(i(t)){m=[];for(q=0;(n=t[q]);q++){m.push(this.expand(n))}}else{if(typeof t==="object"&&t!==f){m={};for(r in t){if(t.hasOwnProperty(r)){m[r]=this.expand(t[r])}}}else{if(typeof t==="string"&&(o=t.match(c.PLACEHOLDER_RE))){s=this.wiring._resolvers[o[1]];m=(s?s.resolve(o[2]):t)}else{m=t}}}return m},getParent:function(){var m=this.cfg.parent;return(m&&this.wiring._defs[m])||f},getCascadedCfg:function(){var n="_cascCfg",m,o,p,q=this[n];if(!q){m=this.cfg;o=this.getParent();if(o){o=o.getCascadedCfg();p=k({},o,m);p.ctorArgs=k([],o.ctorArgs,m.ctorArgs);p.properties=k({},o.properties,m.properties);m=p}q=this[n]=k({},c.defaults,m)}return q},getInstance:function(){var n,r,y,t,x,w=this.getCascadedCfg(),u=w.properties,q=w.type,s=w.ctorArgs,o="function";t=this._instance;if(t&&w.singleton){return t}if(s.length>0){x=function(){};x.prototype=q.prototype;t=new x();q.apply(t,this.expand(s))}else{t=new q()}if(w.singleton){this._instance=t}if(t instanceof g){t.wiring=this.wiring}for(n in u){if(u.hasOwnProperty(n)){r=t["set"+n.charAt(0).toUpperCase()+n.substring(1)];y=this.expand(u[n]);if(r&&typeof r===o){r.call(t,y)}else{t[n]=y}}}if((r=w.initMethod)&&(r=t[r])&&typeof r===o){r.call(t)}return t}});function a(){}j(a,g,{refId:f,createInstance:function(o){if(o){var n=k({},o,{parent:this.refId}),m=new c(this.wiring,n);return m.getInstance()}return this.wiring.get(this.refId)}});function h(){}j(h,g,{prefix:"",resolve:function(m){return m}});function e(){}j(e,h,{prefix:"ref",resolve:function(m){return this.wiring.get(m)}});function b(){this._defs={};this._resolvers={};this.addValueResolver(new e())}j(b,d,{add:function(m){for(var n in m){if(m.hasOwnProperty(n)){this._defs[n]=new c(this,m[n])}}},get:function(m){var n=this._defs[m];return(n?n.getInstance():f)},addValueResolver:function(m){m.wiring=this;this._resolvers[m.prefix]=m},mergeUp:function(m){return new l(m)},WiringAware:g,Factory:a,ValueResolver:h});return new b()})();