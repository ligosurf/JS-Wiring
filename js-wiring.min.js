var Wiring=(function(){function g(l){for(var k=1,j=arguments.length,h,m;k<j;k++){h=arguments[k];if(h){for(m in h){if(h.hasOwnProperty(m)){l[m]=h[m]}}}}return l}function e(){}e.prototype={wiring:null};function d(i,h){this.wiring=i;this.def=h}d.defaults={type:Object,singleton:true,ctorArgs:[],properties:{},initMethod:null,parent:null};d.PLACEHOLDER_RE=/^\{(\w+):(.+)\}$/;d.prototype={expand:function(o){var l,j,m,k,n,h;if(Object.prototype.toString.call(o)==="[object Array]"){h=[];for(l=0;(j=o[l]);l++){h.push(this.expand(j))}}else{if(typeof o==="object"&&o!==null){h={};for(m in o){if(o.hasOwnProperty(m)){h[m]=this.expand(o[m])}}}else{if(typeof o==="string"&&(k=o.match(d.PLACEHOLDER_RE))){n=this.wiring._resolvers[k[1]];h=(n?n.resolve(k[2]):o)}else{h=o}}}return h},getParent:function(){var h=this.def.parent;return(h&&this.wiring._defs[h])||null},getCascadedDef:function(){var h="_cascadedDef",k,i,j,l=this[h];if(!l){k=this.def;i=this.getParent();if(i){i=i.getCascadedDef();j=g({},i,k);j.ctorArgs=g([],i.ctorArgs,k.ctorArgs);j.properties=g({},i.properties,k.properties);k=j}l=this[h]=g({},d.defaults,k)}return l},getInstance:function(){var h,k,t,n,l,o,r,s,j=this.getCascadedDef(),q=j.properties;n=this._instance;if(n&&j.singleton){return n}r=[];s=[];o=j.ctorArgs.length;if(o>0){for(l=0;l<o;l++){r.push(this.expand(j.ctorArgs[l]));s.push("a["+l+"]")}n=(new Function("T","a","return new T("+s.join(",")+")"))(j.type,r)}else{n=new j.type()}if(j.singleton){this._instance=n}if(n instanceof e){n.wiring=this.wiring}for(h in q){if(q.hasOwnProperty(h)){k=n["set"+h.charAt(0).toUpperCase()+h.substring(1)];t=this.expand(q[h]);if(k&&typeof k==="function"){k.call(n,t)}else{n[h]=t}}}if((k=j.initMethod)&&(k=n[k])&&typeof k==="function"){k.call(n)}return n}};function c(){}c.prototype=g(new e(),{refId:null,createInstance:function(j){if(j){var i=g({},j,{parent:this.refId}),h=new d(this.wiring,i);return h.getInstance()}return this.wiring.get(this.refId)}});function f(){}f.prototype=g(new e(),{prefix:"",resolve:function(h){return h}});function b(){}b.prototype=g(new f(),{prefix:"ref",resolve:function(h){return this.wiring.get(h)}});function a(){this._defs={};this._resolvers={};this.addValueResolver(new b())}g(a.prototype,{add:function(h){for(var i in h){if(h.hasOwnProperty(i)){this._defs[i]=new d(this,h[i])}}},get:function(h){var i=this._defs[h];return(i?i.getInstance():null)},addValueResolver:function(h){h.wiring=this;this._resolvers[h.prefix]=h},WiringAware:e,Factory:c,ValueResolver:f});return new a()})();