var Wiring=(function(){var d=Object,f=null;function j(n){for(var m=1,l=arguments.length,k,o;m<l;m++){k=arguments[m];if(k){for(o in k){if(k.hasOwnProperty(o)){n[o]=k[o]}}}}return n}function i(n,o,m){var l=function(){},k="prototype";l[k]=o[k];n[k]=j(new l(),m,{constructor:n})}function g(){}i(g,d,{wiring:f});function c(l,k){this.wiring=l;this.def=k}c.defaults={type:d,singleton:true,ctorArgs:[],properties:{},initMethod:f,parent:f};c.PLACEHOLDER_RE=/^\{(\w+):(.+)\}$/;i(c,d,{expand:function(r){var n,l,o,m,q,k;if(d.prototype.toString.call(r)==="[object Array]"){k=[];for(n=0;(l=r[n]);n++){k.push(this.expand(l))}}else{if(typeof r==="object"&&r!==f){k={};for(o in r){if(r.hasOwnProperty(o)){k[o]=this.expand(r[o])}}}else{if(typeof r==="string"&&(m=r.match(c.PLACEHOLDER_RE))){q=this.wiring._resolvers[m[1]];k=(q?q.resolve(m[2]):r)}else{k=r}}}return k},getParent:function(){var k=this.def.parent;return(k&&this.wiring._defs[k])||f},getCascadedDef:function(){var k="_cascDef",n,l,m,o=this[k];if(!o){n=this.def;l=this.getParent();if(l){l=l.getCascadedDef();m=j({},l,n);m.ctorArgs=j([],l.ctorArgs,n.ctorArgs);m.properties=j({},l.properties,n.properties);n=m}o=this[k]=j({},c.defaults,n)}return o},getInstance:function(){var l,q,A,t,r,u,y,z,k,n=this.getCascadedDef(),x=n.properties,s=n.type,w=n.ctorArgs,o="function";t=this._instance;if(t&&n.singleton){return t}y=[];z=[];u=w.length;if(u>0){k=function(){};k.prototype=s.prototype;t=new k();s.apply(t,this.expand(w))}else{t=new s()}if(n.singleton){this._instance=t}if(t instanceof g){t.wiring=this.wiring}for(l in x){if(x.hasOwnProperty(l)){q=t["set"+l.charAt(0).toUpperCase()+l.substring(1)];A=this.expand(x[l]);if(q&&typeof q===o){q.call(t,A)}else{t[l]=A}}}if((q=n.initMethod)&&(q=t[q])&&typeof q===o){q.call(t)}return t}});function a(){}i(a,g,{refId:f,createInstance:function(m){if(m){var l=j({},m,{parent:this.refId}),k=new c(this.wiring,l);return k.getInstance()}return this.wiring.get(this.refId)}});function h(){}i(h,g,{prefix:"",resolve:function(k){return k}});function e(){}i(e,h,{prefix:"ref",resolve:function(k){return this.wiring.get(k)}});function b(){this._defs={};this._resolvers={};this.addValueResolver(new e())}i(b,d,{add:function(k){for(var l in k){if(k.hasOwnProperty(l)){this._defs[l]=new c(this,k[l])}}},get:function(k){var l=this._defs[k];return(l?l.getInstance():f)},addValueResolver:function(k){k.wiring=this;this._resolvers[k.prefix]=k},WiringAware:g,Factory:a,ValueResolver:h});return new b()})();