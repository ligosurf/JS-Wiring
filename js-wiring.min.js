var Wiring=(function(){var d=Object,f=null;function j(n){for(var m=1,l=arguments.length,k,o;m<l;m++){k=arguments[m];if(k){for(o in k){if(k.hasOwnProperty(o)){n[o]=k[o]}}}}return n}function i(n,o,m){var l=function(){},k="prototype";l[k]=o[k];n[k]=j(new l(),m,{constructor:n})}function g(){}i(g,d,{wiring:f});function c(l,k){this.wiring=l;this.cfg=k}c.defaults={type:d,singleton:true,ctorArgs:[],properties:{},initMethod:f,parent:f};c.PLACEHOLDER_RE=/^\{(\w+):(.+)\}$/;i(c,d,{expand:function(r){var n,l,o,m,q,k;if(d.prototype.toString.call(r)==="[object Array]"){k=[];for(n=0;(l=r[n]);n++){k.push(this.expand(l))}}else{if(typeof r==="object"&&r!==f){k={};for(o in r){if(r.hasOwnProperty(o)){k[o]=this.expand(r[o])}}}else{if(typeof r==="string"&&(m=r.match(c.PLACEHOLDER_RE))){q=this.wiring._resolvers[m[1]];k=(q?q.resolve(m[2]):r)}else{k=r}}}return k},getParent:function(){var k=this.cfg.parent;return(k&&this.wiring._defs[k])||f},getCascadedCfg:function(){var l="_cascCfg",k,m,n,o=this[l];if(!o){k=this.cfg;m=this.getParent();if(m){m=m.getCascadedCfg();n=j({},m,k);n.ctorArgs=j([],m.ctorArgs,k.ctorArgs);n.properties=j({},m.properties,k.properties);k=n}o=this[l]=j({},c.defaults,k)}return o},getInstance:function(){var k,o,w,r,u,t=this.getCascadedCfg(),s=t.properties,n=t.type,q=t.ctorArgs,l="function";r=this._instance;if(r&&t.singleton){return r}if(q.length>0){u=function(){};u.prototype=n.prototype;r=new u();n.apply(r,this.expand(q))}else{r=new n()}if(t.singleton){this._instance=r}if(r instanceof g){r.wiring=this.wiring}for(k in s){if(s.hasOwnProperty(k)){o=r["set"+k.charAt(0).toUpperCase()+k.substring(1)];w=this.expand(s[k]);if(o&&typeof o===l){o.call(r,w)}else{r[k]=w}}}if((o=t.initMethod)&&(o=r[o])&&typeof o===l){o.call(r)}return r}});function a(){}i(a,g,{refId:f,createInstance:function(m){if(m){var l=j({},m,{parent:this.refId}),k=new c(this.wiring,l);return k.getInstance()}return this.wiring.get(this.refId)}});function h(){}i(h,g,{prefix:"",resolve:function(k){return k}});function e(){}i(e,h,{prefix:"ref",resolve:function(k){return this.wiring.get(k)}});function b(){this._defs={};this._resolvers={};this.addValueResolver(new e())}i(b,d,{add:function(k){for(var l in k){if(k.hasOwnProperty(l)){this._defs[l]=new c(this,k[l])}}},get:function(k){var l=this._defs[k];return(l?l.getInstance():f)},addValueResolver:function(k){k.wiring=this;this._resolvers[k.prefix]=k},WiringAware:g,Factory:a,ValueResolver:h});return new b()})();